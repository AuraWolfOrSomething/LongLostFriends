.thumb

.global ExploitSpeed
.type ExploitSpeed, %function


		ExploitSpeed:
		push	{r4-r5,r14}
		mov		r4, r0 @r0 = unit we're checking
		mov		r5, r1 @r1 = unit's opponent (if any)
		
		@Check if any defender (if none, skip to End)
		@ldr		r1, [r1,#4]
		@cmp		r1, #0
		@beq		End
		
		@Check for skill
		ldr		r1, =ExploitSpeedLink
		ldrb	r1, [r1]
		ldr		r3, =SkillTester
		mov		lr, r3
		.short	0xf800
		cmp		r0, #0
		beq		End
		
			@Check if using a sword
			mov		r1, #0x50
			ldrb	r0, [r4,r1]
			cmp		r0, #0
			bne		End
		
				@Check if WTD
				mov		r0, r4
				mov		r1, r5
				ldr		r3, =CheckWeaponTriangleConnection
				mov		lr, r3
				.short	0xF800
				cmp		r0, #0 @1 if WTA, -1 if WTD, 0 if neither
				blt		End
		
					@Add 3 AS
					mov		r1, #0x5E
					ldrb	r0, [r4,r1]
					add		r0, #3
					strb	r0, [r4,r1]
		
		End:
		pop		{r4-r5}
		pop		{r1}
		bx		r1
		
		.align
		.ltorg

